<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MassGen Session Viewer</title>
    <link rel="stylesheet" href="style.css">
    <!-- React peer dependencies for artifact renderers -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</head>
<body>
    <div class="container">
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Loading session...</p>
        </div>

        <div id="error" class="error-container" style="display: none;">
            <h2>Error Loading Session</h2>
            <p id="error-message"></p>
            <a href="https://github.com/massgen/MassGen" class="link">Learn more about MassGen</a>
        </div>

        <div id="content" style="display: none;">
            <!-- Session Header -->
            <header class="session-header">
                <div class="logo">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M8 12h8M12 8v8"/>
                    </svg>
                    MassGen Session
                </div>
                <div class="question-text" id="question"></div>
                <div class="meta-row">
                    <div class="meta-item">
                        <span class="meta-label">Date:</span>
                        <span class="meta-value" id="date"></span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Duration:</span>
                        <span class="meta-value" id="duration"></span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Cost:</span>
                        <span class="meta-value" id="cost"></span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Winner:</span>
                        <span class="winner-badge" id="winner"></span>
                    </div>
                </div>
            </header>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card" title="Total estimated API cost for this session">
                    <div class="stat-value" id="stat-cost">-</div>
                    <div class="stat-label">Estimated Cost</div>
                </div>
                <div class="stat-card" title="Total tokens used (input + output + reasoning)">
                    <div class="stat-value" id="stat-tokens">-</div>
                    <div class="stat-label">Total Tokens</div>
                </div>
                <div class="stat-card" title="Number of tool/MCP calls made by agents">
                    <div class="stat-value" id="stat-tools">-</div>
                    <div class="stat-label">Tool Calls</div>
                </div>
                <div class="stat-card" title="A round is one complete agent cycle: work â†’ answer/vote â†’ restart. Includes answer rounds, voting rounds, and presentation rounds.">
                    <div class="stat-value" id="stat-rounds">-</div>
                    <div class="stat-label">Rounds</div>
                </div>
                <div class="stat-card" title="Number of AI agents participating in this session">
                    <div class="stat-value" id="stat-agents">-</div>
                    <div class="stat-label">Agents</div>
                </div>
            </div>

            <!-- Config Section (Try This) -->
            <section class="section config-section-top" id="try-session-section">
                <h2 class="section-title">ðŸš€ Try This Session</h2>
                <div id="config-container"></div>
            </section>

            <!-- Glossary (collapsible) -->
            <div class="glossary-toggle" onclick="document.getElementById('glossary').classList.toggle('open')">
                <span>ðŸ“– Glossary</span>
                <span class="glossary-icon">â–¶</span>
            </div>
            <div id="glossary" class="glossary">
                <div class="glossary-grid">
                    <div class="glossary-item">
                        <dt>Round (per-agent)</dt>
                        <dd>One complete cycle for a single agent: work â†’ answer/vote/presentation â†’ restart. Each agent tracks its own round count independently. The "Rounds" stat shows the sum across all agents.</dd>
                    </div>
                    <div class="glossary-item">
                        <dt>Answer</dt>
                        <dd>An agent's proposed solution to the task. Multiple agents can provide competing answers.</dd>
                    </div>
                    <div class="glossary-item">
                        <dt>Vote</dt>
                        <dd>Agents evaluate all available answers and vote for the best one, providing reasoning for their choice.</dd>
                    </div>
                    <div class="glossary-item">
                        <dt>Restart</dt>
                        <dd>When an agent completes a round, it restarts with fresh context including other agents' answers, votes, and feedback.</dd>
                    </div>
                    <div class="glossary-item">
                        <dt>Presentation</dt>
                        <dd>The final round where the winning agent presents the polished final answer.</dd>
                    </div>
                    <div class="glossary-item">
                        <dt>Workspace</dt>
                        <dd>Each agent's isolated file system directory where they can create and modify files during the task.</dd>
                    </div>
                </div>
            </div>

            <!-- Agents Section -->
            <section class="section">
                <h2 class="section-title">Agents</h2>
                <div class="agent-grid" id="agents-container"></div>
            </section>

            <!-- Tools Section -->
            <section class="section">
                <h2 class="section-title">Tools Used</h2>
                <div class="tools-list" id="tools-container"></div>
            </section>

            <!-- Coordination Flow Section -->
            <section class="section">
                <h2 class="section-title">Coordination Flow</h2>
                <div class="timeline" id="timeline-container"></div>
            </section>

            <!-- Agent Activity Section -->
            <section class="section">
                <h2 class="section-title">Agent Activity</h2>
                <div id="answers-container"></div>
            </section>

            <!-- Final Answer Section -->
            <section class="final-answer-section">
                <div class="final-answer-header">
                    <h2 class="section-title" style="margin-bottom: 0;">Final Answer</h2>
                    <button class="copy-btn" onclick="copyFinalAnswer()">Copy</button>
                </div>
                <div class="final-answer-content" id="final-answer"></div>
            </section>

            <!-- Workspace Section (legacy - now integrated in Agent Activity) -->
            <section class="section" id="workspace-section" style="display: none;">
                <h2 class="section-title">Agent Workspaces</h2>
                <div id="workspace-container"></div>
            </section>

            <!-- Agent Outputs Section -->
            <section class="section">
                <h2 class="section-title">Agent Output Logs</h2>
                <div id="outputs-container"></div>
            </section>

            <!-- Footer -->
            <footer class="export-footer">
                <p>Shared via <a href="https://github.com/massgen/MassGen" target="_blank">MassGen</a></p>
                <p id="gist-link"></p>
            </footer>
        </div>
    </div>

    <!-- Artifact Preview Modal -->
    <div id="artifact-preview-modal" class="artifact-modal">
        <div class="artifact-modal-header">
            <span id="artifact-preview-title">Artifact Preview</span>
            <button onclick="closeArtifactPreview()" class="artifact-modal-close">&times;</button>
        </div>
        <div id="artifact-preview-container" class="artifact-modal-content"></div>
    </div>

    <!-- MassGen Artifact Renderers (built from webui) -->
    <script src="lib/massgen-renderers.umd.js"></script>
    <script src="app.js"></script>
</body>
</html>
